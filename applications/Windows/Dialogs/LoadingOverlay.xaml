<?xml version="1.0" encoding="utf-8"?>
<UserControl
    x:Class="CloudflareR2Browser.Dialogs.LoadingOverlay"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    mc:Ignorable="d"
    Visibility="{x:Bind IsVisible, Mode=OneWay, Converter={StaticResource BoolToVisibilityConverter}}">

    <Grid>
        <!-- Semi-transparent background -->
        <Rectangle
            Fill="Black"
            Opacity="0.4" />

        <!-- Center card with loading content -->
        <Grid
            HorizontalAlignment="Center"
            VerticalAlignment="Center"
            MaxWidth="400">

            <Border
                Background="{ThemeResource CardBackgroundFillColorDefaultBrush}"
                BorderBrush="{ThemeResource CardStrokeColorDefaultBrush}"
                BorderThickness="1"
                CornerRadius="12"
                Padding="32,28">

                <Border.Shadow>
                    <ThemeShadow />
                </Border.Shadow>

                <StackPanel Spacing="20" MinWidth="240">

                    <!-- Indeterminate ProgressRing (shown when Progress is null) -->
                    <ProgressRing
                        x:Name="IndeterminateRing"
                        Width="48"
                        Height="48"
                        HorizontalAlignment="Center"
                        IsActive="True"
                        Visibility="{x:Bind ShowIndeterminate, Mode=OneWay, Converter={StaticResource BoolToVisibilityConverter}}" />

                    <!-- Determinate ProgressBar (shown when Progress has value) -->
                    <StackPanel
                        x:Name="DeterminateProgress"
                        Spacing="12"
                        Visibility="{x:Bind ShowDeterminate, Mode=OneWay, Converter={StaticResource BoolToVisibilityConverter}}">

                        <ProgressBar
                            Value="{x:Bind ProgressValue, Mode=OneWay}"
                            Maximum="100"
                            MinWidth="240"
                            Height="4" />

                        <TextBlock
                            Text="{x:Bind ProgressText, Mode=OneWay}"
                            HorizontalAlignment="Center"
                            Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                            Style="{StaticResource CaptionTextBlockStyle}" />
                    </StackPanel>

                    <!-- Loading message -->
                    <StackPanel Spacing="8">
                        <TextBlock
                            Text="{x:Bind Message, Mode=OneWay}"
                            HorizontalAlignment="Center"
                            TextAlignment="Center"
                            FontWeight="SemiBold"
                            TextWrapping="Wrap" />

                        <TextBlock
                            Text="{x:Bind SubMessage, Mode=OneWay}"
                            HorizontalAlignment="Center"
                            TextAlignment="Center"
                            Foreground="{ThemeResource TextFillColorSecondaryBrush}"
                            Style="{StaticResource CaptionTextBlockStyle}"
                            TextWrapping="Wrap"
                            Visibility="{x:Bind HasSubMessage, Mode=OneWay, Converter={StaticResource BoolToVisibilityConverter}}" />
                    </StackPanel>

                    <!-- Cancel button (shown if cancellable) -->
                    <Button
                        x:Name="CancelButton"
                        Content="Cancel"
                        HorizontalAlignment="Center"
                        Click="CancelButton_Click"
                        Visibility="{x:Bind IsCancellable, Mode=OneWay, Converter={StaticResource BoolToVisibilityConverter}}"
                        MinWidth="120">
                        <Button.Style>
                            <Style TargetType="Button" BasedOn="{StaticResource DefaultButtonStyle}">
                                <Setter Property="Background" Value="{ThemeResource SubtleFillColorSecondaryBrush}" />
                            </Style>
                        </Button.Style>
                    </Button>

                    <!-- Progress details (optional) -->
                    <Border
                        x:Name="DetailsPanel"
                        Background="{ThemeResource LayerFillColorDefaultBrush}"
                        BorderBrush="{ThemeResource DividerStrokeColorDefaultBrush}"
                        BorderThickness="1"
                        CornerRadius="6"
                        Padding="12"
                        Visibility="{x:Bind HasDetails, Mode=OneWay, Converter={StaticResource BoolToVisibilityConverter}}">

                        <StackPanel Spacing="6">
                            <TextBlock
                                Text="Details"
                                FontWeight="SemiBold"
                                Style="{StaticResource CaptionTextBlockStyle}"
                                Foreground="{ThemeResource TextFillColorSecondaryBrush}" />

                            <ItemsControl ItemsSource="{x:Bind Details, Mode=OneWay}">
                                <ItemsControl.ItemTemplate>
                                    <DataTemplate x:DataType="x:String">
                                        <TextBlock
                                            Text="{x:Bind}"
                                            Style="{StaticResource CaptionTextBlockStyle}"
                                            TextWrapping="Wrap"
                                            Margin="0,2" />
                                    </DataTemplate>
                                </ItemsControl.ItemTemplate>
                            </ItemsControl>
                        </StackPanel>
                    </Border>
                </StackPanel>
            </Border>
        </Grid>
    </Grid>
</UserControl>
