<Window
    x:Class="CloudflareR2Browser.MainWindow"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:local="using:CloudflareR2Browser"
    xmlns:views="using:CloudflareR2Browser.Views"
    Title="Cloudflare R2 Object Storage Browser">

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/> <!-- Header -->
            <RowDefinition Height="*"/> <!-- Content -->
        </Grid.RowDefinitions>

        <!-- Header with server status -->
        <Grid Grid.Row="0" Background="{ThemeResource LayerFillColorDefaultBrush}" Padding="20,16">
            <StackPanel HorizontalAlignment="Center" Spacing="8">
                <TextBlock Text="Cloudflare R2 Object Storage Browser"
                           Style="{StaticResource TitleTextBlockStyle}"/>
                <StackPanel Orientation="Horizontal" Spacing="8" HorizontalAlignment="Center">
                    <Ellipse Width="8" Height="8" Fill="{Binding ViewModel.ServerStatusColor, Mode=OneWay}"/>
                    <TextBlock Text="{Binding ViewModel.ServerStatusText, Mode=OneWay}"
                               FontSize="12" Foreground="{ThemeResource TextFillColorSecondaryBrush}"/>
                </StackPanel>
            </StackPanel>

            <StackPanel Orientation="Horizontal" Spacing="8" HorizontalAlignment="Right">
                <Button Content="Transfer Queue"
                        Command="{Binding ViewModel.ToggleTransferQueueCommand}"/>
                <Button Content="Debug"
                        Command="{Binding ViewModel.ToggleDebugPanelCommand}"/>
                <Button Content="Settings"
                        Command="{Binding ViewModel.ShowSettingsCommand}"/>
            </StackPanel>
        </Grid>

        <!-- Main content with 2-column layout -->
        <Grid Grid.Row="1">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="250" MinWidth="200" MaxWidth="400"/>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="*"/>
            </Grid.ColumnDefinitions>

            <!-- Left: Bucket Sidebar -->
            <views:BucketSidebarView Grid.Column="0"
                                     DataContext="{Binding ViewModel.BucketSidebarViewModel}"/>

            <!-- GridSplitter -->
            <Border Grid.Column="1" Width="1" Background="{ThemeResource DividerStrokeColorDefaultBrush}"/>

            <!-- Right: Content Area -->
            <Grid Grid.Column="2">
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/> <!-- Toolbar -->
                    <RowDefinition Height="Auto"/> <!-- Breadcrumb -->
                    <RowDefinition Height="*"/> <!-- File List -->
                    <RowDefinition Height="Auto"/> <!-- Debug/Transfer Panel -->
                </Grid.RowDefinitions>

                <!-- Toolbar -->
                <views:ToolbarView Grid.Row="0"
                                   DataContext="{Binding ViewModel.FileListViewModel}"/>

                <!-- Breadcrumb -->
                <views:BreadcrumbView Grid.Row="1"
                                      DataContext="{Binding ViewModel.FileListViewModel}"/>

                <!-- File List -->
                <views:FileListView Grid.Row="2"
                                    DataContext="{Binding ViewModel.FileListViewModel}"/>

                <!-- Transfer Queue Panel -->
                <views:TransferQueuePanel Grid.Row="3" Height="250"
                                          BorderBrush="{ThemeResource DividerStrokeColorDefaultBrush}"
                                          BorderThickness="0,1,0,0"
                                          DataContext="{Binding ViewModel.TransferManagerViewModel}"
                                          Visibility="{Binding ViewModel.IsTransferQueueVisible, Converter={StaticResource BoolToVisibilityConverter}, Mode=OneWay}"/>

                <!-- Debug Panel -->
                <views:DebugPanelView Grid.Row="3" Height="250"
                                      BorderBrush="{ThemeResource DividerStrokeColorDefaultBrush}"
                                      BorderThickness="0,1,0,0"
                                      DataContext="{Binding ViewModel.DebugPanelViewModel}"
                                      Visibility="{Binding ViewModel.IsDebugPanelVisible, Converter={StaticResource BoolToVisibilityConverter}, Mode=OneWay}"/>
            </Grid>
        </Grid>
    </Grid>
</Window>
